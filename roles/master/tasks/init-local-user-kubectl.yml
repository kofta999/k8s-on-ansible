- name: "Create .kube directory for {{ ansible_user }} user"
  ansible.builtin.file:
    path: "~/.kube"
    state: directory
    owner: "{{ ansible_user }}"
    group: "{{ ansible_user }}"
    mode: "0755"
  register: kube_dir

- name: "Copy admin.conf to user's .kube directory"
  become: true
  ansible.builtin.copy:
    src: /etc/kubernetes/admin.conf
    dest: "{{ kube_dir.path }}/config"
    owner: "{{ ansible_user }}"
    group: "{{ ansible_user }}"
    mode: "0644"
    remote_src: true
